# OpenCue Build and Test Pipeline

# Trigger the pipeline on every commit to master. Pull Requests to any branch will trigger
# the pipeline as well, by default.
trigger:
- master

jobs:
- job: setEnv
  displayName: Set Environment
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - bash: |
      ci/generate_version_number.sh
      echo "##vso[task.setvariable variable=buildId;isOutput=true]$(cat ./VERSION)"
    name: setBuildId
  - bash: echo $(setBuildId.buildId)
    name: echovar

- job: build
  displayName: Build
  dependsOn: setEnv
  pool:
    vmImage: 'ubuntu-16.04'
  variables:
    buildId: $[ dependencies.setEnv.outputs['setBuildId.buildId'] ]
  steps:
  - bash: echo $(buildId)
    name: echovar
